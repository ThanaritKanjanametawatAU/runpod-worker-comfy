#!/bin/bash
set -e

# Enable BuildKit
export DOCKER_BUILDKIT=1

# Get the model type from the branch name or use default
MODEL_TYPE=${MODEL_TYPE:-flux1-dev}

# Build the image with BuildKit enabled
docker build \
  --build-arg MODEL_TYPE=${MODEL_TYPE} \
  --build-arg HUGGINGFACE_ACCESS_TOKEN=${HUGGINGFACE_ACCESS_TOKEN} \
  --platform linux/amd64 \
  -t ${DOCKER_REPO}:${DOCKER_TAG} \
  .
